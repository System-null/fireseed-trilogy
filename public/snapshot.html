<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Fireseed Snapshot Â· äººç±»å¯è¯»å¿«ç…§</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;background:#fff;color:#111}
    .bar{position:sticky;top:0;background:#0d1117;color:#dfe2e7;padding:6px 12px;font-size:12px;display:flex;gap:8px;align-items:center}
    .bar a{color:#9ecbff;text-decoration:none}
    .page{max-width:840px;margin:12px auto;padding:12px 24px 24px}
    h1{font-size:22px;margin:0 0 6px}
    .muted{color:#666;font-size:12px}
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:16px;margin:14px 0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .small{font-size:12px;color:#666}
    .btn{display:inline-block;border:1px solid #e6e6e6;border-radius:10px;padding:8px 12px;margin-right:8px;text-decoration:none;color:#111}
    @media print{ .btn{display:none} .page{padding:0} .bar{display:none} }
  </style>
</head>
<body>
  <div class="bar">
    <span>Language:</span>
    <a href="#" data-lang="zh-CN">ä¸­æ–‡</a> Â·
    <a href="#" data-lang="en-US">English</a> Â·
    <a href="#" data-lang="ja-JP">æ—¥æœ¬èª</a>
  </div>
  <div class="page">
    <h1 id="t_title">Fireseed Snapshot Â· äººç±»å¯è¯»å¿«ç…§</h1>
    <div class="muted" id="t_sub">å¯æ‰“å°ï¼Œä¸€é¡µä¿å­˜ã€‚è‹¥éœ€è¿”å›è¡¨å•ï¼Œè¯·å…³é—­æ­¤é¡µã€‚</div>

    <div id="content" class="card">è½½å…¥ä¸­â€¦</div>

    <div class="small" id="t_legal">
      å¼‚è®®æœŸï¼šå®¶äºº/å—æ‰˜äººå¯åœ¨ 30~90 å¤©å†…è”ç³»â€œç´§æ€¥è”ç³»äººâ€æå‡ºä¿®æ­£ã€‚<br/>
      æ›´æ–°è·¯å¾„ï¼šå›åˆ°ç”Ÿæˆå™¨ â†’ ä¸Šä¼ æ—§æ–‡ä»¶ â†’ ä¿®æ”¹ â†’ é‡æ–°ç”Ÿæˆã€‚<br/>
      <span id="pwNotice" style="display:none">æœªè®¾æ›´æ–°å¯†ç ï¼Œæ—¥åå¯è¡¥ï¼ˆä¸‹æ¬¡ç”Ÿæˆæ—¶å¡«å†™å³å¯ï¼‰ã€‚</span><br/>
      æ³•å¾‹å£°æ˜ï¼šæœ¬å¿«ç…§ä¸å…·å¤‡ç›´æ¥æ³•å¾‹æ•ˆåŠ›ï¼Œå±äºä¸ªäººæ„æ„¿è¡¨è¾¾ã€‚è‹¥éœ€è¦å…·æœ‰æ³•å¾‹çº¦æŸåŠ›çš„æ–‡ä»¶ï¼Œè¯·å’¨è¯¢ä¸“ä¸šäººå£«ã€‚
    </div>
    <p>
      <a class="btn" href="#" onclick="window.print()">ğŸ–¨ï¸ <span id="t_print">æ‰“å° / å­˜æˆ PDF</span></a>
    </p>
  </div>

<script>
const I18N = {
  "zh-CN": {
    title: "Fireseed Snapshot Â· äººç±»å¯è¯»å¿«ç…§",
    sub: "å¯æ‰“å°ï¼Œä¸€é¡µä¿å­˜ã€‚è‹¥éœ€è¿”å›è¡¨å•ï¼Œè¯·å…³é—­æ­¤é¡µã€‚",
    owner: "æ‰€æœ‰è€…", lang: "è¯­è¨€",
    refs: "æˆ‘æ€è€ƒæ—¶çš„â€œå‚è€ƒä¹¦â€",
    p3: "æˆ‘çš„ä¸‰åŸåˆ™",
    nn: "æˆ‘çš„åº•çº¿",
    loop: { trigger:"æ„ŸçŸ¥/è§¦å‘", judgment:"åˆ¤æ–­", execute:"è¡ŒåŠ¨", correct:"åæ€/çº æ­£" },
    likes:"æˆ‘å–œæ¬¢", dislikes:"æˆ‘è®¨åŒ", dates:"é‡è¦æ—¥æœŸ", emerg:"ç´§æ€¥è”ç³»äºº",
    legal: 'å¼‚è®®æœŸï¼šå®¶äºº/å—æ‰˜äººå¯åœ¨ 30~90 å¤©å†…è”ç³»â€œç´§æ€¥è”ç³»äººâ€æå‡ºä¿®æ­£ã€‚<br/>æ›´æ–°è·¯å¾„ï¼šå›åˆ°ç”Ÿæˆå™¨ â†’ ä¸Šä¼ æ—§æ–‡ä»¶ â†’ ä¿®æ”¹ â†’ é‡æ–°ç”Ÿæˆã€‚<br/><span id="pwNotice" style="display:none">æœªè®¾æ›´æ–°å¯†ç ï¼Œæ—¥åå¯è¡¥ï¼ˆä¸‹æ¬¡ç”Ÿæˆæ—¶å¡«å†™å³å¯ï¼‰ã€‚</span><br/>æ³•å¾‹å£°æ˜ï¼šæœ¬å¿«ç…§ä¸å…·å¤‡ç›´æ¥æ³•å¾‹æ•ˆåŠ›ï¼Œå±äºä¸ªäººæ„æ„¿è¡¨è¾¾ã€‚è‹¥éœ€è¦å…·æœ‰æ³•å¾‹çº¦æŸåŠ›çš„æ–‡ä»¶ï¼Œè¯·å’¨è¯¢ä¸“ä¸šäººå£«ã€‚',
    print: "æ‰“å° / å­˜æˆ PDF"
  },
  "en-US": {
    title: "Fireseed Snapshot Â· Human-readable",
    sub: "Printable on one page. Close this tab to go back to the form.",
    owner: "Owner", lang: "Language",
    refs: "My Reference Books / Ideas",
    p3: "My Three Principles",
    nn: "My Nonâ€‘negotiables",
    loop: { trigger:"Perception/Trigger", judgment:"Judgment", execute:"Action", correct:"Reflection/Correction" },
    likes:"I like", dislikes:"I dislike", dates:"Important dates", emerg:"Emergency contact",
    legal: 'Objection window: family/trustee may propose corrections within 30â€“90 days via the emergency contact.<br/>To update: open the generator â†’ upload old file â†’ modify â†’ regenerate.<br/><span id="pwNotice" style="display:none">No update passphrase set; you can add one next time.</span><br/>Disclaimer: this snapshot has no direct legal effect. Consult professionals for legally binding documents.',
    print: "Print / Save as PDF"
  },
  "ja-JP": {
    title: "Fireseed ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆäººé–“å‘ã‘ï¼‰",
    sub: "1ãƒšãƒ¼ã‚¸ã§å°åˆ·å¯èƒ½ã€‚ãƒ•ã‚©ãƒ¼ãƒ ã«æˆ»ã‚‹ã«ã¯ã“ã®ã‚¿ãƒ–ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚",
    owner: "æ‰€æœ‰è€…", lang: "è¨€èª",
    refs: "ç§ã®æ€è€ƒã‚’å½¢ä½œã£ãŸæœ¬ãƒ»äººç‰©",
    p3: "ç§ã®ä¸‰ã¤ã®åŸå‰‡",
    nn: "è­²ã‚Œãªã„ä¸€ç·š",
    loop: { trigger:"çŸ¥è¦š/ãƒˆãƒªã‚¬ãƒ¼", judgment:"åˆ¤æ–­", execute:"è¡Œå‹•", correct:"å†…çœ/ä¿®æ­£" },
    likes:"å¥½ã", dislikes:"è‹¦æ‰‹", dates:"å¤§åˆ‡ãªæ—¥ä»˜", emerg:"ç·Šæ€¥é€£çµ¡å…ˆ",
    legal: 'ç•°è­°æœŸé–“ï¼šå®¶æ—/å—è¨—è€…ã¯ 30ã€œ90 æ—¥ä»¥å†…ã«ã€Œç·Šæ€¥é€£çµ¡å…ˆã€ã¸ä¿®æ­£ã‚’ç”³ã—å‡ºã§ãã¾ã™ã€‚<br/>æ›´æ–°æ–¹æ³•ï¼šã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã«æˆ»ã‚Š â†’ æ—§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ ä¿®æ­£ â†’ å†ç”Ÿæˆã€‚<br/><span id="pwNotice" style="display:none">æ›´æ–°ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã¯æœªè¨­å®šã€‚æ¬¡å›è¿½åŠ ã§ãã¾ã™ã€‚</span><br/>å…è²¬ï¼šæœ¬ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¯æ³•çš„åŠ¹åŠ›ã‚’æŒã¡ã¾ã›ã‚“ã€‚æ³•çš„æ–‡æ›¸ã¯å°‚é–€å®¶ã«ã”ç›¸è«‡ãã ã•ã„ã€‚',
    print: "å°åˆ· / PDFã¨ã—ã¦ä¿å­˜"
  }
};

function parseYAML(text){
  const lines = text.split(/\r?\n/);
  const stack = [{}];
  const indents = [0];
  function set(obj, key, val){
    if(Array.isArray(obj[key])) obj[key].push(val);
    else if(key in obj && typeof obj[key]==='object' && typeof val==='object'){ Object.assign(obj[key], val); }
    else obj[key]=val;
  }
  for(const raw of lines){
    if(/^#/.test(raw)) continue;
    const m = raw.match(/^(\s*)([^:#-][^:]*)\s*:\s*(.*)$/);
    const a = raw.match(/^(\s*)-\s*(.*)$/);
    if(m){
      const [, sp, key, val] = m;
      const indent = sp.length;
      while(indent < indents[indents.length-1]){ indents.pop(); stack.pop(); }
      if(val===''){
        const obj = {};
        set(stack[stack.length-1], key.trim(), obj);
        stack.push(obj); indents.push(indent+2);
      }else{
        set(stack[stack.length-1], key.trim(), val.replace(/^\"|\"$/g,''));
      }
    }else if(a){
      const [, sp, val] = a;
      const indent = sp.length;
      while(indent < indents[indents.length-1]){ indents.pop(); stack.pop(); }
      const parent = stack[stack.length-1];
      const arrayKey = Object.keys(parent).slice(-1)[0];
      if(!Array.isArray(parent[arrayKey])) parent[arrayKey]=[];
      parent[arrayKey].push(val.replace(/^\"|\"$/g,''));
    }
  }
  return stack[0];
}

function esc(s){ return (s||'').replace(/[&<>]/g,c=>({'&':'&','<':'&lt;','>':'&gt;'}[c])); }

function applyLang(lang){
  const t = I18N[lang] || I18N["zh-CN"];
  document.getElementById('t_title').textContent = t.title;
  document.getElementById('t_sub').textContent = t.sub;
  document.getElementById('t_print').textContent = t.print;
  document.getElementById('t_legal').innerHTML = t.legal;
  window.__t__ = t;
  if(window.__c__) render(window.__c__);
}

function render(c){
  window.__c__ = c;
  const t = window.__t__ || I18N["zh-CN"];
  const el = document.getElementById('content');
  const parts = [];
  parts.push(`<div class='row'><div><strong>${esc(t.owner)}</strong><br>${esc(c.owner||'anonymous')}`+
             `</div><div><strong>${esc(t.lang)}</strong><br>${esc(c.locale||'-')}</div></div>`);
  if(c.philosophy_refs && c.philosophy_refs.length){
    parts.push(`<div><strong>${esc(t.refs)}</strong><br>${esc(c.philosophy_refs.join('ã€'))}</div>`);
  }
  if(c.narrative && c.narrative.story){
    parts.push(`<p>${esc(c.narrative.story)}</p>`);
  }
  if(c.principles && c.principles.length){
    parts.push(`<div><strong>${esc(t.p3)}</strong><ul>${c.principles.map(x=>`<li>${esc(x)}</li>`).join('')}</ul></div>`);
  }
  if(c.non_negotiables && c.non_negotiables.length){
    parts.push(`<div><strong>${esc(t.nn)}</strong><ul>${c.non_negotiables.map(x=>`<li>${esc(x)}</li>`).join('')}</ul></div>`);
  }
  if(c.loop){
    const seg = [];
    if(c.loop.trigger) seg.push(`${esc(t.loop.trigger)}ï¼š${esc(c.loop.trigger)}`);
    if(c.loop.judgment) seg.push(`${esc(t.loop.judgment)}ï¼š${esc(c.loop.judgment)}`);
    if(c.loop.execute) seg.push(`${esc(t.loop.execute)}ï¼š${esc(c.loop.execute)}`);
    if(c.loop.correct) seg.push(`${esc(t.loop.correct)}ï¼š${esc(c.loop.correct)}`);
    if(seg.length) parts.push(`<div>${seg.join(" ï½œ ")}</div>`);
  }
  if(c.narrative && c.narrative.ext){
    const e = c.narrative.ext;
    if(e.likes?.length || e.dislikes?.length || e.celebration_dates?.length || e.emergency_contact){
      parts.push("<hr>");
      if(e.likes?.length) parts.push(`<div><strong>${esc(t.likes)}</strong>ï¼š${esc(e.likes.join('ã€'))}</div>`);
      if(e.dislikes?.length) parts.push(`<div><strong>${esc(t.dislikes)}</strong>ï¼š${esc(e.dislikes.join('ã€'))}</div>`);
      if(e.celeation_dates?.length) parts.push(`<div><strong>${esc(t.dates)}</strong>ï¼š${esc(e.celebration_dates.join('ã€'))}</div>`);
      if(e.emergency_contact){
        parts.push(`<div><strong>${esc(t.emerg)}</strong>ï¼š${esc(e.emergency_contact.name||'')} Â· ${esc(e.emergency_contact.contact||'')}</div>`);
      }
      if(!e.update_passphrase) document.getElementById("pwNotice")?.style && (document.getElementById("pwNotice").style.display = "inline");
    }
  }
  parts.push("<hr>");
  parts.push(`<div class='mono small'>UTC Generated: ${esc(new Date().toISOString())}</div>`);
  el.innerHTML = parts.join("");
}

(function(){
  const raw = decodeURIComponent(location.hash.replace(/^#(print#)?/,''));
  const data = parseYAML(raw);
  document.querySelectorAll('.bar a').forEach(a=>{
    a.addEventListener('click', e=>{ e.preventDefault(); applyLang(a.dataset.lang); });
  });
  applyLang(new URLSearchParams(location.search).get('lang') || 'zh-CN');
  render(data);
  if(location.hash.startsWith("#print#")) setTimeout(()=>window.print(), 300);
})();
</script>
</body>
</html>
