<!--
  LEGACY: Fireseed capsule validator (static demo)
  LEGACY：Fireseed Capsule 旧版静态校验器

  - 用于在 GitHub Pages / 纯静态环境下做 schema 校验演示。
  - 当前推荐使用 apps/web 中的 Capsule Workspace 作为主要校验界面。
  - 访问 GitHub Pages 时路径类似：
      https://system-null.github.io/fireseed-trilogy/validator.html
    （注意：路径中不要包含 /public 前缀。）

  This is an older static validator for demos on GitHub Pages or other static hosts.
  For current usage, please prefer the Capsule Workspace under apps/web.
  On GitHub Pages, the URL usually looks like:
      https://system-null.github.io/fireseed-trilogy/validator.html
  (Note: no /public prefix in the URL.)
-->
<!doctype html>
<meta charset="utf-8" />
<title>Fireseed Capsule Validator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 24px; }
  .drop { border: 2px dashed #999; border-radius: 12px; padding: 24px; text-align: center; color: #666; }
  pre { background: #0b1020; color: #cfe6ff; padding: 12px; border-radius: 8px; overflow: auto; }
  .ok { color: #0a7f2e; font-weight: 600; }
  .bad { color: #b00020; font-weight: 600; }
</style>
<script>window.useCdn=false;</script>
<script src="../vendor/js-yaml.min.js" onerror="useCdn=true"></script>
<script>if(useCdn){document.write('<script src="https://unpkg.com/js-yaml/dist/js-yaml.min.js"><\\/script>')}</script>
<script src="../vendor/ajv.min.js"></script>
<script>if(typeof Ajv==='undefined'){document.write('<script src="https://unpkg.com/ajv@8/dist/ajv.min.js"><\\/script>')}</script>
<h1>Fireseed Capsule Validator</h1>
<p>把 <code>capsule_v0.yaml</code> 拖进下方区域，本页会在本地完成解析与校验。</p>
<div class="drop" id="drop">Drop YAML here</div>
<div id="out"></div>
<script>
const schema={type:"object",required:["meta","principles","loop","boundary"],properties:{
  meta:{type:"object",required:["owner","locale","created_at","philosophy_ref"],
    properties:{owner:{type:"string"},locale:{type:"string"},created_at:{type:"string"},philosophy_ref:{type:"array",items:{type:"string"}}}},
  principles:{type:"array",items:{type:"string"}},
  loop:{type:"object",required:["trigger","steps"],properties:{trigger:{type:"string"},steps:{type:"array",items:{type:"string"}}}},
  boundary:{type:"object",required:["non_negotiables"],properties:{non_negotiables:{type:"array",items:{type:"string"}}}},
  ethical_flag:{type:"integer"} } };
const ajv=new Ajv({allErrors:true,strict:false});
const validate=ajv.compile(schema);
const drop=document.getElementById('drop'), out=document.getElementById('out');
["dragenter","dragover","dragleave","drop"].forEach(ev=> drop.addEventListener(ev,(e)=>{e.preventDefault();e.stopPropagation();}));
drop.addEventListener('drop', async (e)=>{
  const file=e.dataTransfer.files[0]; if(!file) return;
  const text=await file.text(); let data;
  try{ data = jsyaml.load(text); }
  catch(err){ out.innerHTML="<p class=bad>YAML parse error:</p><pre>"+(err&&err.message||String(err))+"</pre>"; return; }
  try{
    const ok=validate(data);
    if(ok){ out.innerHTML="<p class=ok>Schema validation passed ✅</p><pre>"+JSON.stringify(data,null,2)+"</pre>"; }
    else{ out.innerHTML="<p class=bad>Schema validation errors ❌</p><pre>"+JSON.stringify(validate.errors,null,2)+"</pre>"; }
  }catch(err){ out.innerHTML="<p class=bad>Validator error:</p><pre>"+(err&&err.message||String(err))+"</pre>"; }
});
</script>
