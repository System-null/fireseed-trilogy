
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fireseed Capsule Generator Â· Wizard v3</title>

  <!-- UI (no build step) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.12/dist/tailwind.min.css">
  <style>
    .card{background:rgba(255,255,255,.86);backdrop-filter:saturate(180%) blur(12px)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace}
    .step-dot{width:.65rem;height:.65rem;border-radius:9999px}
    .glass{background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.75));}
    .btn{border:1px solid #e2e8f0;border-radius:.65rem;padding:.5rem .9rem}
    .btn-prim{background:#2563eb;border-color:#1d4ed8;color:#fff}
    .btn-amber{background:#d97706;border-color:#b45309;color:#fff}
    .btn:hover{filter:saturate(110%)}
    .hint{font-size:.8rem;color:#64748b}
    .toast{position:fixed;right:1rem;bottom:1rem;z-index:60}
    .hidden{display:none}
    .kbd{border:1px solid #e5e7eb;border-radius:.375rem;padding:.15rem .4rem;background:#f9fafb}
  </style>

  <!-- Logic libs -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <!-- Header -->
  <header class="sticky top-0 z-20 glass border-b border-slate-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-4">
      <div class="w-1.5 h-6 bg-amber-500 rounded"></div>
      <h1 class="text-lg md:text-xl font-semibold">Fireseed Capsule Generator Â· å‘å¯¼ç‰ˆ</h1>
      <span class="text-xs text-slate-500">ç”Ÿæˆä½ çš„ <span class="mono">capsule_v0.yaml</span></span>
      <div class="ml-auto flex items-center gap-2 text-sm">
        <a class="btn" href="../README.md" target="_blank">ğŸ“– é¡¹ç›®ä¸»é¡µ</a>
        <a class="btn" href="../tools/validator.html" target="_blank">âœ… éªŒè¯å™¨</a>
        <button id="lang" class="btn">ä¸­ / EN</button>
      </div>
    </div>
  </header>

  <!-- Intro -->
  <section class="max-w-5xl mx-auto px-4 mt-6">
    <div class="card rounded-2xl border border-slate-200 p-5">
      <p>Fireseed Capsule æ˜¯ä¸€ä¸ªä¸ºæœªæ¥ç³»ç»Ÿç•™ä¸‹â€œæ€æƒ³ç«ç§â€çš„æ•°æ®åŒ…ã€‚ä½ æ— éœ€æ‡‚ä»£ç ï¼Œå¡«å†™ 3~4 ç»„ä¿¡æ¯ï¼Œç³»ç»Ÿå°†ç”Ÿæˆå¯è¢« AGI è§£æä¸å­˜æ¡£çš„ <span class="mono">capsule_v0.yaml</span> æ–‡ä»¶ã€‚</p>
      <div class="mt-3 flex flex-wrap gap-2 text-xs">
        <span class="px-2 py-1 rounded-full bg-slate-100">ğŸ“¦ æœ¬åœ°ç”Ÿæˆ</span>
        <span class="px-2 py-1 rounded-full bg-slate-100">ğŸ§ª å¯éªŒè¯</span>
        <span class="px-2 py-1 rounded-full bg-slate-100">ğŸ”’ éšç§ï¼šæ•°æ®ä¸å‡ºæµè§ˆå™¨</span>
      </div>
    </div>
  </section>

  <!-- Wizard -->
  <main class="max-w-5xl mx-auto px-4 mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Left: steps -->
    <section class="lg:col-span-2 card rounded-2xl border border-slate-200 p-6">
      <div class="flex items-center gap-3 mb-4">
        <div id="dot1" class="step-dot bg-amber-500"></div><div class="text-sm">åŸºæœ¬ä¿¡æ¯</div>
        <div id="dot2" class="step-dot bg-slate-300 ml-3"></div><div class="text-sm">ç†å¿µä¸å¾ªç¯</div>
        <div id="dot3" class="step-dot bg-slate-300 ml-3"></div><div class="text-sm">è¾¹ç•Œä¸å¤‡æ³¨</div>
        <div id="dot4" class="step-dot bg-slate-300 ml-3"></div><div class="text-sm">ç”Ÿæˆä¸æ ¡éªŒ</div>
      </div>

      <form id="wizard" class="space-y-6">
        <!-- Step 1 -->
        <fieldset id="step1">
          <legend class="font-medium">â‘  åŸºæœ¬ä¿¡æ¯</legend>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">ç½²å / Owner</label>
              <input id="owner" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="å¦‚ï¼šJiaMing Yang / ç«ç§-2025-07" />
              <p class="hint mt-1">å°†å†™å…¥ <span class="mono">owner</span> å­—æ®µä¸ç­¾åæ³¨é‡Šã€‚</p>
            </div>
            <div>
              <label class="block text-sm font-medium">è¯­è¨€ / Locale</label>
              <select id="locale" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option value="zh-CN">zh-CNï¼ˆä¸­æ–‡ï¼‰</option>
                <option value="en-US">en-USï¼ˆEnglishï¼‰</option>
              </select>
            </div>
          </div>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium">ä¼¦ç†æ ‡è®° / Ethical Flag</label>
              <select id="ethical" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2">
                <option value="0">0ï¼ˆé»˜è®¤ï¼‰</option>
                <option value="experimental">experimentalï¼ˆå®éªŒæ€§ï¼‰</option>
                <option value="confirmed">confirmedï¼ˆå·²å®¡é˜…ï¼‰</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium">çµæ„Ÿå¼•ç”¨ / Philosophy Refsï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
              <textarea id="refs" rows="3" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="The Last Interface Â· Ch.3&#10;Beyond the System Â· Ch.2"></textarea>
            </div>
          </div>
        </fieldset>

        <!-- Step 2 -->
        <fieldset id="step2" class="hidden">
          <legend class="font-medium">â‘¡ ç†å¿µä¸å¾ªç¯</legend>
          <div>
            <label class="block text-sm font-medium">æ ¸å¿ƒåŸåˆ™ / Principlesï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
            <textarea id="principles" rows="3" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="ä»¥æœ€å°èƒ½è€—è¾¾æˆæœ€å¤§ç†è§£&#10;ç»“æ„è‡ªæ´½ä¼˜å…ˆ&#10;é¿å…è¿‡æ‹Ÿåˆç°å®"></textarea>
          </div>
          <div class="mt-3">
            <label class="block text-sm font-medium">å¾ªç¯æ­¥éª¤ / Loop Stepsï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
            <textarea id="loops" rows="3" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="observe&#10;record&#10;reflect&#10;redesign"></textarea>
          </div>
        </fieldset>

        <!-- Step 3 -->
        <fieldset id="step3" class="hidden">
          <legend class="font-medium">â‘¢ è¾¹ç•Œä¸å¤‡æ³¨</legend>
          <div>
            <label class="block text-sm font-medium">ä¸å¯å¦¥å / Nonâ€‘negotiablesï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
            <textarea id="nonneg" rows="3" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="no non-consensual extraction of time&#10;no harm for mere efficiency"></textarea>
          </div>
          <div class="mt-3">
            <label class="block text-sm font-medium">å¤‡æ³¨ / Notesï¼ˆå¯é€‰ï¼‰</label>
            <textarea id="notes" rows="2" class="w-full mt-1 rounded-lg border border-slate-300 px-3 py-2" placeholder="ä½ çš„ç«ç§èƒŒåçš„æ•…äº‹ã€çº¦æŸæˆ–ä½¿ç”¨å»ºè®®"></textarea>
          </div>
        </fieldset>

        <!-- Step 4 -->
        <fieldset id="step4" class="hidden">
          <legend class="font-medium">â‘£ ç”Ÿæˆä¸æ ¡éªŒ</legend>
          <ul class="list-disc pl-5 text-sm text-slate-600">
            <li>ç‚¹å‡»â€œç”Ÿæˆç«ç§â€å°†ä¸‹è½½ <span class="mono">capsule_v0.yaml</span>ï¼ˆä»…åœ¨æœ¬åœ°æµè§ˆå™¨å†…ç”Ÿæˆï¼‰ã€‚</li>
            <li>ä¸‹è½½åå¯ç‚¹å‡»â€œæ‰“å¼€éªŒè¯å™¨â€è¿›è¡Œç»“æ„æ ¡éªŒä¸ç­¾åã€‚</li>
          </ul>

          <div class="mt-4 grid grid-cols-2 gap-3">
            <button type="button" id="btn-generate" class="btn btn-amber">ğŸ”¥ ç”Ÿæˆç«ç§</button>
            <a class="btn" id="btn-validate" href="../tools/validator.html" target="_blank">âœ… æ‰“å¼€éªŒè¯å™¨</a>
          </div>
        </fieldset>

        <div class="mt-6 flex items-center justify-between">
          <div class="flex gap-2 text-xs text-slate-500">
            <button type="button" id="btn-demo" class="btn">æˆ‘ä¸çŸ¥é“å†™ä»€ä¹ˆï¼ˆå¡«å…¥ç¤ºä¾‹ï¼‰</button>
            <label class="flex items-center gap-2"><input id="autosave" type="checkbox" class="scale-110" checked> è‡ªåŠ¨ä¿å­˜</label>
          </div>
          <div class="flex gap-2">
            <button type="button" id="prev" class="btn">â† ä¸Šä¸€æ­¥</button>
            <button type="button" id="next" class="btn btn-prim">ä¸‹ä¸€æ­¥ â†’</button>
          </div>
        </div>
      </form>
    </section>

    <!-- Right: live preview -->
    <aside class="card rounded-2xl border border-slate-200 p-6">
      <h3 class="font-medium">å®æ—¶é¢„è§ˆ</h3>
      <pre id="yaml" class="mono text-sm mt-3 p-3 bg-slate-900 text-slate-100 rounded-lg overflow-auto h-72"></pre>
      <div class="mt-4 grid grid-cols-2 gap-3 text-sm">
        <button id="copy" class="btn">å¤åˆ¶ YAML</button>
        <label class="btn cursor-pointer text-center">
          å¯¼å…¥ YAML
          <input id="import" type="file" accept=".yml,.yaml" class="hidden" />
        </label>
      </div>
      <h3 class="font-medium mt-6">è¯­ä¹‰æ‘˜è¦</h3>
      <div id="summary" class="text-sm text-slate-600 mt-2 leading-relaxed"></div>
      <p class="hint mt-3">éšç§æç¤ºï¼šæ‰€æœ‰æ•°æ®ä»…åœ¨ä½ çš„æµè§ˆå™¨ä¸­å¤„ç†ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>
    </aside>
  </main>

  <div id="toast" class="toast hidden">
    <div class="rounded-lg bg-emerald-600 text-white px-4 py-2 shadow">å·²ç”Ÿæˆ <span class="mono">capsule_v0.yaml</span></div>
  </div>

  <script>
    // ---------- State & helpers ----------
    const $ = (s,el=document)=>el.querySelector(s);
    const $$ = (s,el=document)=>Array.from(el.querySelectorAll(s));
    const F = ['owner','locale','ethical','refs','principles','loops','nonneg','notes'];
    const lsKey = 'fireseed_wizard_v3';

    let step = 1, autosave = true;

    const getLines = v => (v||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);

    function buildData(){
      return {
        version: 'capsule_v0',
        owner: $('#owner').value.trim() || 'anonymous',
        locale: $('#locale').value,
        ethical_flag: $('#ethical').value,
        philosophy_refs: getLines($('#refs').value),
        principles: getLines($('#principles').value),
        loop_steps: getLines($('#loops').value),
        non_negotiables: getLines($('#nonneg').value),
        notes: ($('#notes').value || '').trim() || undefined,
        meta: {
          generated_at: new Date().toISOString(),
          generator: 'fireseed-generator-wizard-v3'
        }
      };
    }

    function toYAML(obj){
      try{ return jsyaml.dump(obj,{lineWidth:100}); }
      catch(e){ return '# YAML ç”Ÿæˆå¤±è´¥: '+e.message; }
    }

    function simpleValidate(d){
      const errs = [];
      if(!d.owner || d.owner==='anonymous') errs.push('è¯·å¡«å†™ç½²åï¼ˆOwnerï¼‰ã€‚');
      if(!d.principles || d.principles.length<1) errs.push('è‡³å°‘å¡«å†™ 1 æ¡æ ¸å¿ƒåŸåˆ™ã€‚');
      if(!d.loop_steps || d.loop_steps.length<1) errs.push('è‡³å°‘å¡«å†™ 1 ä¸ªå¾ªç¯æ­¥éª¤ã€‚');
      return errs;
    }

    function render(){
      const d = buildData();
      $('#yaml').textContent = toYAML(d);
      const p = d.principles.length, l = d.loop_steps.length, n = d.non_negotiables.length;
      $('#summary').innerHTML = `â€¢ ç½²åï¼š<span class="mono">${d.owner}</span>ï¼›è¯­è¨€ï¼š<span class="mono">${d.locale}</span><br/>â€¢ åŸåˆ™ <span class="mono">${p}</span> æ¡ï¼Œå¾ªç¯ <span class="mono">${l}</span> æ­¥ï¼Œåº•çº¿ <span class="mono">${n}</span> é¡¹ã€‚`;
      if(autosave){
        const payload = {}; F.forEach(k=>payload[k] = $('#'+k)?.value || '');
        localStorage.setItem(lsKey, JSON.stringify(payload));
      }
      // step dots
      [1,2,3,4].forEach(i=>$('#dot'+i).className = 'step-dot '+(i<=step?'bg-amber-500':'bg-slate-300'));
    }

    function showStep(n){
      step = Math.min(4, Math.max(1,n));
      ['step1','step2','step3','step4'].forEach((id,i)=>$('#'+id).classList.toggle('hidden', i+1!==step));
      render();
    }

    function download(name, text){
      const blob = new Blob([text], {type:'text/yaml;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = name;
      document.body.appendChild(a); a.click(); a.remove();
      $('#toast').classList.remove('hidden');
      setTimeout(()=>$('#toast').classList.add('hidden'), 1500);
    }

    function loadLS(){
      try{
        const data = JSON.parse(localStorage.getItem(lsKey)||'{}');
        F.forEach(k=>{ if($('#'+k) && data[k]!==undefined) $('#'+k).value = data[k]; });
      }catch(e){}
    }

    // ---------- Events ----------
    $('#next').onclick = ()=> showStep(step+1);
    $('#prev').onclick = ()=> showStep(step-1);
    $('#autosave').onchange = e=>{ autosave = !!e.target.checked; if(autosave) render(); };

    F.forEach(k=>{ const el = $('#'+k); if(el) el.addEventListener('input', render); });

    $('#btn-demo').onclick = ()=>{
      if(!$('#owner').value) $('#owner').value = 'System Null';
      if(!$('#principles').value) $('#principles').value = 'ä»¥æœ€å°èƒ½è€—è¾¾æˆæœ€å¤§ç†è§£\nç»“æ„è‡ªæ´½ä¼˜å…ˆ\né¿å…è¿‡æ‹Ÿåˆç°å®';
      if(!$('#loops').value) $('#loops').value = 'observe\nrecord\nreflect\nredesign';
      if(!$('#nonneg').value) $('#nonneg').value = 'no non-consensual extraction of time\nno harm for mere efficiency';
      if(!$('#refs').value) $('#refs').value = 'The Last Interface Â· Ch.3\nBeyond the System Â· Ch.2';
      render();
    };

    $('#copy').onclick = async ()=>{
      try{ await navigator.clipboard.writeText($('#yaml').textContent); }catch(e){}
      const t=$('#toast'); t.querySelector('div').textContent='å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
      t.classList.remove('hidden'); setTimeout(()=>{ t.classList.add('hidden'); t.querySelector('div').innerHTML='å·²ç”Ÿæˆ <span class="mono">capsule_v0.yaml</span>'; }, 1100);
    };

    $('#import').onchange = async (e)=>{
      const f = e.target.files?.[0]; if(!f) return;
      const text = await f.text();
      try{
        const obj = jsyaml.load(text) || {};
        // basic mapping
        const map = {
          owner:'owner', locale:'locale', ethical_flag:'ethical',
          philosophy_refs:'refs', principles:'principles',
          loop_steps:'loops', non_negotiables:'nonneg', notes:'notes'
        };
        Object.entries(map).forEach(([src,target])=>{
          if(obj[src]!==undefined){
            const val = Array.isArray(obj[src]) ? obj[src].join('\n') : String(obj[src]||'');
            const el = $('#'+target); if(el) el.value = val;
          }
        });
        render(); showStep(4);
      }catch(err){ alert('YAML è§£æå¤±è´¥ï¼š'+err.message); }
    };

    $('#btn-generate').onclick = ()=>{
      const d = buildData();
      const errs = simpleValidate(d);
      if(errs.length){ alert('è¯·å®Œå–„ä»¥ä¸‹å†…å®¹ï¼š\n- '+errs.join('\n- ')); return; }
      download('capsule_v0.yaml', toYAML(d));
    };

    // i18n toggle (basic placeholders)
    $('#lang').onclick = ()=>{
      const zh = document.documentElement.lang === 'zh-CN';
      document.documentElement.lang = zh ? 'en' : 'zh-CN';
      $('#lang').textContent = zh ? 'EN / ä¸­' : 'ä¸­ / EN';
      // swap placeholders minimally
      if(zh){
        $('#owner').placeholder='e.g., Luna Wei / Fireseed-2025-07';
        $('#principles').placeholder='Max understanding at minimal energy\nSelf-consistency first';
        $('#nonneg').placeholder='no non-consensual extraction of time\nno harm for mere efficiency';
      }else{
        $('#owner').placeholder='å¦‚ï¼šJiaMing Yang / ç«ç§-2025-07';
        $('#principles').placeholder='ä»¥æœ€å°èƒ½è€—è¾¾æˆæœ€å¤§ç†è§£\nç»“æ„è‡ªæ´½ä¼˜å…ˆ\né¿å…è¿‡æ‹Ÿåˆç°å®';
        $('#nonneg').placeholder='no non-consensual extraction of time\nno harm for mere efficiency';
      }
    };

    // boot
    loadLS(); render(); showStep(1);
  </script>
</body>
</html>
