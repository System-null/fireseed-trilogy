version: "3.8"
services:
  redis:
    image: redis:7-alpine

  fastapi:
    build: .
    environment:
      - REDIS_URL=redis://redis:6379/0
      - HF_HUB_DISABLE_TELEMETRY=1
      - LOCAL_FILES_ONLY=1
    volumes:
      - ./data:/app/data
      - ./static/og:/app/static/og
    depends_on: [redis]

  prometheus:
    image: prom/prometheus
    volumes:
      - ./ops/prometheus.yml:/etc/prometheus/prometheus.yml:ro
    depends_on: [fastapi]

  grafana:
    image: grafana/grafana:10.4.2
    volumes:
      - ./ops/grafana:/var/lib/grafana
    depends_on: [prometheus]
